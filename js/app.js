(function(){const y=document.getElementById('year');if(y)y.textContent=String(new Date().getFullYear());async function load(){const g=document.getElementById('episodesGrid');if(!g)return;try{const r=await fetch('data/episodes.json',{cache:'no-store'});const e=await r.json();g.innerHTML=e.slice(0,3).map(ep=>{const t=esc(String(ep.title||''));const m=esc([ep.date,ep.duration].filter(Boolean).join(' • '));const p=attr(ep.playUrl||'#');const i=attr(ep.infoUrl||'#');return `<article class="episode"><div class="episode-cover" aria-hidden="true"></div><div><h3>${t}</h3><div class="meta">${m}</div></div><div class="actions"><a class="btn btn-primary" href="${p}">Play</a><a class="btn" href="${i}">More info</a></div></article>`;}).join('');}catch(_){g.innerHTML='<div class="card"><h3>Error</h3><p class="muted">No se pudieron cargar los episodios.</p></div>';}}function sub(){const f=document.getElementById('subscribeForm');if(!f)return;f.addEventListener('submit',ev=>{ev.preventDefault();const n=(f.elements.namedItem('name')?.value||'').trim();const em=(f.elements.namedItem('email')?.value||'').trim();if(!em)return;const to='you@example.com';const s=encodeURIComponent('Subscribe: El Ático de las Historias');const b=encodeURIComponent(`Nombre: ${n}\nEmail: ${em}\n`);window.location.href=`mailto:${to}?subject=${s}&body=${b}`;});}function esc(str){return str.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}function attr(str){return String(str).replace(/"/g,'&quot;');}load();sub();})();